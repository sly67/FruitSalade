# Single-container deployment: PostgreSQL + FruitSalade in one container
#
# Uses local filesystem storage (no MinIO/S3 required).
# Data persists via named volumes.
#
# Usage:
#   docker compose -f phase2/docker/docker-compose.single.yml up -d
#   curl http://localhost:8080/health
#   Browse: http://localhost:8080/app/

services:
  fruitsalade:
    build:
      context: ../..
      dockerfile: phase2/docker/Dockerfile.single
    ports:
      - "8080:8080"
      - "9090:9090"
    environment:
      POSTGRES_USER: fruitsalade
      POSTGRES_PASSWORD: fruitsalade
      POSTGRES_DB: fruitsalade
      JWT_SECRET: change-me-in-production
      STORAGE_BACKEND: local
      LOCAL_STORAGE_PATH: /data/storage
      SEED_DATA: "true"
      LOG_LEVEL: info
      LOG_FORMAT: console
    volumes:
      - pg_data:/data/postgres
      - storage_data:/data/storage

volumes:
  pg_data:
  storage_data:
